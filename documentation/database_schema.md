# Database Schema

This document describes the relational schema for the Job Tracker application, including tables, columns, keys, and relationships.

## Overview

- Users are stored in a custom user table extending Django's `AbstractUser` (`apps.users.models.CustomUser`).
- Job applications are stored in `JobApplication` (`apps.core.models.JobApplication`) and linked to a user via a foreign key.

## Entity Relationship Diagram (Text)

```
CustomUser (1) ────────────< (N) JobApplication
```

- One `CustomUser` can have many `JobApplication` records.
- Deleting a `CustomUser` cascades deletes to their `JobApplication` rows.

## Tables

### Table: `users_customuser`
- Inherits core auth fields from `AbstractUser`:
  - `id` (PK, bigint/serial)
  - `username` (varchar, unique)
  - `password` (hashed)
  - `is_superuser`, `is_staff`, `is_active` (bool)
  - `last_login`, `date_joined` (datetime)
  - plus standard name/email fields used by Django.
- Custom fields:
  - `email` (EmailField, unique)
  - `first_name` (CharField, max_length=30, blank=True)
  - `last_name` (CharField, max_length=30, blank=True)
  - `is_job_seeker` (BooleanField, default=True)
  - `date_joined` (DateTimeField, auto_now_add=True)

Constraints and Indexes:
- `UNIQUE (email)`
- Implicit indexes on `username` and `id` (PK).

### Table: `core_jobapplication`
Represents a single job application entry.

Columns:
- `id` (PK, bigint/serial)
- `user_id` (FK → `users_customuser.id`, on_delete=CASCADE, indexed)
- `company_name` (CharField, max_length=200)
- `position_title` (CharField, max_length=200)
- `job_description` (TextField, blank)
- `application_date` (DateField)
- `status` (CharField, max_length=20, choices)
  - Allowed values: `applied | interview_scheduled | interview_completed | offer_received | rejected | withdrawn`
- `job_url` (URLField, blank)
- `contact_person` (CharField, max_length=100, blank)
- `contact_email` (EmailField, blank)
- `contact_phone` (CharField, max_length=20, blank)
- `salary_range` (CharField, max_length=100, blank)
- `location` (CharField, max_length=200, blank)
- `remote_option` (BooleanField, default=False)
- `notes` (TextField, blank)
- `cv` (FileField, upload_to=`uploads/cvs/`, null=True, blank=True)
- `cover_letter` (FileField, upload_to=`uploads/cover_letters/`, null=True, blank=True)
- `created_at` (DateTimeField, auto_now_add=True)
- `updated_at` (DateTimeField, auto_now=True)

Constraints and Indexes:
- `INDEX (user_id)`
- `ORDER BY application_date DESC, created_at DESC` (via `Meta.ordering`)

## DDL (Illustrative)

Note: Actual DDL is generated by Django migrations, but the following illustrates the shape:

```sql
-- users_customuser
CREATE TABLE users_customuser (
  id BIGSERIAL PRIMARY KEY,
  username VARCHAR(150) NOT NULL UNIQUE,
  email VARCHAR(254) NOT NULL UNIQUE,
  first_name VARCHAR(30),
  last_name VARCHAR(30),
  is_job_seeker BOOLEAN NOT NULL DEFAULT TRUE,
  date_joined TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW()
  -- plus standard AbstractUser columns (password, is_active, etc.)
);

-- core_jobapplication
CREATE TABLE core_jobapplication (
  id BIGSERIAL PRIMARY KEY,
  user_id BIGINT NOT NULL REFERENCES users_customuser(id) ON DELETE CASCADE,
  company_name VARCHAR(200) NOT NULL,
  position_title VARCHAR(200) NOT NULL,
  job_description TEXT,
  application_date DATE NOT NULL,
  status VARCHAR(20) NOT NULL,
  job_url TEXT,
  contact_person VARCHAR(100),
  contact_email VARCHAR(254),
  contact_phone VARCHAR(20),
  salary_range VARCHAR(100),
  location VARCHAR(200),
  remote_option BOOLEAN NOT NULL DEFAULT FALSE,
  notes TEXT,
  cv TEXT,
  cover_letter TEXT,
  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW()
);

CREATE INDEX idx_core_jobapplication_user_id ON core_jobapplication(user_id);
```

## Relationships

- `core_jobapplication.user_id` → `users_customuser.id` (CASCADE on delete)

## Notes

- File fields (`cv`, `cover_letter`) store file paths; actual files are stored under `media/uploads/...` and managed by Django storage backends.
- Status column is constrained via application-level choices; consider a CHECK constraint if enforcing at the DB level is required.
- Email is unique at the user level to prevent duplicate registrations.

## Migration Source

See generated migrations for authoritative schema:
- `apps/users/migrations/0001_initial.py`
- `apps/core/migrations/0001_initial.py` and subsequent migration files.
